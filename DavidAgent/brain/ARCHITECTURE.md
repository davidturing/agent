# 仿生双脑多智能体架构详细设计方案

## 一、架构系统总览
系统模拟人类大脑的认知与记忆机制，采用 **双模态计算（左右脑）+ 双轨记忆（长短期结构）** 的核心设计。系统不再是线性的流水线，而是一个基于事件驱动（Event-Driven）的响应式生命体。

**目标**：摄入 X 网站及其他外部高价值信息，经过消化、吸收、提炼，最终内化为系统知识，并以"科技达人"的 Persona（人设）对外输出观点或文章。

## 二、核心中枢设计（计算层）

### 1. 右脑中枢 (主控与创造)
- **驱动模型**：qwen3-coder-plus (通义千问)
- **角色定义**：全局统筹者、创意总监、Persona 合成器。
- **核心职责**：
  - 意图分发：接收外部刺激（如定时任务触发、用户指令），决定何时将子任务委托给左脑。
  - 内容创作：调用"科技达人"的语料和人设，生成富有网感、连贯的对外发布内容（推文回复、WordPress 博客）。
  - 情感与共情：处理交互中的基调把控。

### 2. 左脑中枢 (逻辑与解析)
- **驱动模型**：Gemini (通过 API 被右脑或系统事件唤醒)
- **角色定义**：逻辑提取器、图谱构建师、事实核查员。
- **核心职责**：
  - 信息解构：深度阅读 X 网站的长推文或文章，精准提取核心观点。
  - 图谱挖掘：从非结构化文本中抽取"实体-关系-实体"的三元组网络（如 [OpenClaw] -> [属于] -> [Multi-Agent框架]）。
  - 逻辑审查：在右脑输出最终内容前，进行逻辑严密性和事实准确性的交叉验证（防幻觉）。

## 三、仿生记忆网络设计（存储层）
这是系统能够实现"自我进化"的基础设施。

### 1. 虚拟胼胝体 (短期工作记忆 / Working Memory)
- **技术选型**：Node.js EventEmitter 或轻量级状态机 (如 XState)。
- **实现机制**：构建一个 **响应式黑板 (Reactive Blackboard)**。在内存中维护当前任务的状态树（包含原始数据、提取的事实、生成草稿、审查意见）。左右脑作为独立 Observer 监听黑板变化，避免复杂的进程间通信，彻底杜绝 spawn EBADF 等系统级异常。

### 2. 虚拟海马体 (长期记忆 / Long-term Memory) —— 混合 GraphRAG 架构
长期记忆分为"感性语义"与"理性逻辑"双轨并行：

- **轨道 A：语义模糊联想 (ChromaDB + LlamaIndex.TS)**
  - 用途：存储完整的文章切片、推文总结的向量数据。
  - 机制：统一使用一种 Embedding 模型。当右脑需要创作时，提供宏观的上下文背景和相似历史语料库。

- **轨道 B：精准逻辑图谱 (PageIndex 本地知识库)**
  - 用途：存储由左脑提炼的硬核逻辑关系。
  - 存储路径：持久化到 `skills/self-learning-agent/pageindex/knowledge/` 目录下的 Markdown 文件中。
  - 机制：以标准化 Markdown 语法构建知识图谱网络。确保右脑在调用专业技术名词时具备绝对的精确度。

## 四、核心工作流：X 网站知识吸收与数字分身进化
以下是系统获取到 X 网站一条高价值技术 Thread 后的完整流转过程：

### 感知 (Stimulus)
- ag 引擎的数据抓取模块获取到推文内容，将其写入黑板的 `raw_x_post` 节点。

### 左脑解析与知识固化 (Knowledge Ingestion)
- Gemini 监听到新数据，被唤醒。
- 动作 1：生成结构化三元组，自动追加写入到 `pageindex/knowledge/` 的 Markdown 体系中，扩展逻辑边界。
- 动作 2：生成语义摘要，调用 LlamaIndex.TS 向量化存入 ChromaDB，扩展语义边界。
- Gemini 将"提取完毕"的状态写回黑板。

### 右脑创作 (Persona Synthesis)
- 千问监听到知识吸收完毕，开始执行输出任务（如撰写一篇关于该推文的深度解析博客）。
- 混合检索：千问向海马体发出查询，同时获取 ChromaDB 的相关背景和 PageIndex 中的精准实体关系。
- 千问结合"科技达人"人设，生成博客草稿，写入黑板的 `blog_draft` 节点。

### 左右脑互搏审查 (Cross-Review)
- Gemini 监听到新草稿，启动逻辑审查模式。
- 将草稿与 PageIndex 中的核心事实进行比对，若发现技术术语误用，则将错误反馈写入黑板，打回给千问重写；若无误，则标记为 `ready_to_publish`。

### 运动神经输出 (Action)
- ag 引擎底层框架监听到发布就绪状态，自动调用 WordPress 或 X 网站的 API 将内容推送到线上。

## 五、技术栈集成清单
- **运行时与编排**：Node.js, OpenClaw (核心运行框架)
- **大模型接口**：
  - `@google/generative-ai` (Gemini API，左脑)
  - `openai` 兼容包 (DashScope 千问 API，右脑)
- **RAG 与数据编排**：LlamaIndex.TS
- **向量数据库**：ChromaDB (本地化部署运行)
- **图谱存储**：Node.js 原生 fs 模块 (直接对 PageIndex 目录进行 Markdown 读写操作)
- **通信总线**：Node.js events 模块构建 Blackboard。

这套设计将千问的广度与表达力同 Gemini 的深度与解析力完美结合，同时利用 PageIndex 和 ChromaDB 构建了坚不可摧的记忆底座。